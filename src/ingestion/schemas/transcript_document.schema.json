{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": [
    "metadata"
  ],
  "properties": {
    "metadata": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "type": "object",
      "required": [
        "job_id",
        "timestamp"
      ],
      "properties": {
        "job_id": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9-_]+$",
          "minLength": 1,
          "maxLength": 128
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "audio_filename": {
          "type": "string",
          "minLength": 1
        },
        "duration_seconds": {
          "type": "number",
          "minimum": 0
        },
        "language": {
          "type": "string",
          "enum": [
            "fr",
            "en",
            "es",
            "de",
            "it",
            "pt"
          ]
        },
        "model_version": {
          "type": "string"
        },
        "source": {
          "type": "string",
          "default": "transcript-service"
        }
      },
      "additionalProperties": true
    },
    "segments": {
      "type": "array",
      "items": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "required": [
          "speaker",
          "text"
        ],
        "properties": {
          "speaker": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100
          },
          "text": {
            "type": "string",
            "minLength": 1
          },
          "start_time": {
            "type": "number",
            "minimum": 0
          },
          "end_time": {
            "type": "number",
            "minimum": 0
          },
          "timestamp_ms": {
            "type": "integer",
            "minimum": 0
          },
          "confidence": {
            "type": "number",
            "minimum": 0.0,
            "maximum": 1.0
          },
          "annotations": {
            "$schema": "http://json-schema.org/draft-07/schema#",
            "type": "object",
            "description": "Optional NLP annotations from transcript service (v1.1+)",
            "properties": {
              "sentiment": {
                "$schema": "http://json-schema.org/draft-07/schema#",
                "type": "object",
                "description": "Sentiment analysis annotation (optional, from transcript service)",
                "required": [
                  "label",
                  "score"
                ],
                "properties": {
                  "label": {
                    "type": "string",
                    "enum": [
                      "very_positive",
                      "positive",
                      "neutral",
                      "negative",
                      "very_negative",
                      "mixed"
                    ]
                  },
                  "score": {
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 1.0
                  },
                  "stars": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 5
                  },
                  "metadata": {
                    "type": "object",
                    "properties": {
                      "model": {
                        "type": "string"
                      },
                      "version": {
                        "type": "string"
                      }
                    },
                    "additionalProperties": true
                  }
                },
                "additionalProperties": false
              },
              "entities": {
                "type": "array",
                "items": {
                  "$schema": "http://json-schema.org/draft-07/schema#",
                  "type": "object",
                  "description": "Named entity extracted via NER (optional, from transcript service)",
                  "required": [
                    "type",
                    "text"
                  ],
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": [
                        "PERSON",
                        "ORG",
                        "LOC",
                        "DATE",
                        "TIME",
                        "MONEY",
                        "MISC"
                      ]
                    },
                    "text": {
                      "type": "string",
                      "minLength": 1
                    },
                    "start_char": {
                      "type": "integer",
                      "minimum": 0
                    },
                    "end_char": {
                      "type": "integer",
                      "minimum": 0
                    },
                    "confidence": {
                      "type": "number",
                      "minimum": 0.0,
                      "maximum": 1.0
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "model": {
                          "type": "string"
                        },
                        "normalized_form": {
                          "type": "string"
                        }
                      },
                      "additionalProperties": true
                    }
                  },
                  "additionalProperties": false
                }
              }
            },
            "additionalProperties": true
          }
        },
        "additionalProperties": true
      },
      "minItems": 1
    },
    "turns": {
      "type": "array",
      "items": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "type": "object",
        "required": [
          "speaker",
          "text"
        ],
        "properties": {
          "speaker": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100
          },
          "text": {
            "type": "string",
            "minLength": 1
          },
          "start_time": {
            "type": "number",
            "minimum": 0
          },
          "end_time": {
            "type": "number",
            "minimum": 0
          },
          "timestamp_ms": {
            "type": "integer",
            "minimum": 0
          },
          "confidence": {
            "type": "number",
            "minimum": 0.0,
            "maximum": 1.0
          },
          "annotations": {
            "$schema": "http://json-schema.org/draft-07/schema#",
            "type": "object",
            "description": "Optional NLP annotations from transcript service (v1.1+)",
            "properties": {
              "sentiment": {
                "$schema": "http://json-schema.org/draft-07/schema#",
                "type": "object",
                "description": "Sentiment analysis annotation (optional, from transcript service)",
                "required": [
                  "label",
                  "score"
                ],
                "properties": {
                  "label": {
                    "type": "string",
                    "enum": [
                      "very_positive",
                      "positive",
                      "neutral",
                      "negative",
                      "very_negative",
                      "mixed"
                    ]
                  },
                  "score": {
                    "type": "number",
                    "minimum": 0.0,
                    "maximum": 1.0
                  },
                  "stars": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 5
                  },
                  "metadata": {
                    "type": "object",
                    "properties": {
                      "model": {
                        "type": "string"
                      },
                      "version": {
                        "type": "string"
                      }
                    },
                    "additionalProperties": true
                  }
                },
                "additionalProperties": false
              },
              "entities": {
                "type": "array",
                "items": {
                  "$schema": "http://json-schema.org/draft-07/schema#",
                  "type": "object",
                  "description": "Named entity extracted via NER (optional, from transcript service)",
                  "required": [
                    "type",
                    "text"
                  ],
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": [
                        "PERSON",
                        "ORG",
                        "LOC",
                        "DATE",
                        "TIME",
                        "MONEY",
                        "MISC"
                      ]
                    },
                    "text": {
                      "type": "string",
                      "minLength": 1
                    },
                    "start_char": {
                      "type": "integer",
                      "minimum": 0
                    },
                    "end_char": {
                      "type": "integer",
                      "minimum": 0
                    },
                    "confidence": {
                      "type": "number",
                      "minimum": 0.0,
                      "maximum": 1.0
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "model": {
                          "type": "string"
                        },
                        "normalized_form": {
                          "type": "string"
                        }
                      },
                      "additionalProperties": true
                    }
                  },
                  "additionalProperties": false
                }
              }
            },
            "additionalProperties": true
          }
        },
        "additionalProperties": true
      },
      "minItems": 1
    },
    "transcript": {
      "type": "string",
      "minLength": 1
    }
  },
  "oneOf": [
    {
      "required": [
        "segments"
      ]
    },
    {
      "required": [
        "turns"
      ]
    },
    {
      "required": [
        "transcript"
      ]
    }
  ],
  "additionalProperties": true
}